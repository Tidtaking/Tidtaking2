document.getElementById('searchBtn').addEventListener('click', async () => {
  const name = document.getElementById('searchName').value.trim();
  const location = document.getElementById('searchLocation').value.trim();
  const date = document.getElementById('searchDate').value;
  const resultsContainer = document.getElementById('searchResults');

  console.log('Søker med følgende kriterier:');
  console.log('Navn:', name);
  console.log('Sted:', location);
  console.log('Dato:', date);

  let query = supabase.from('selvanviser').select('*').order('dato', { ascending: false });
  
  // Bygg søkekriteriene
  if (name) {
    query = query.ilike('navn', `%${name}%`);
  }
  if (location) {
    query = query.ilike('sted', `%${location}%`);
  }
  if (date) {
    query = query.eq('dato', date);
  }

  console.log('Spørring:', query); // Sjekk spørringen før den kjøres
  
  // Kjør spørringen
  const { data, error } = await query;
  if (error) {
    console.error('Feil ved henting av data:', error);
    resultsContainer.innerHTML = 'Feil ved henting av data.';
    return;
  }
  console.log('Data hentet:', data);

  if (!data.length) {
    resultsContainer.innerHTML = 'Ingen resultater funnet.';
    return;
  }

  // Vis resultater
  const rows = data.map(r => `
    <tr>
      <td>${r.navn}</td>
      <td>${r.dato}</td>
      <td>${r.serie}</td>
      <td>${r.sted}</td>
      <td>${r.skudd}</td>
      <td>${r.poeng}</td>
      <td>${r.tid}</td>
      <td>${r.vindretning}</td>
      <td>${r.skrumelding}</td>
      <td><img src="${r.miniatur_dataurl}" width="80"></td>
    </tr>
  `).join('');

  resultsContainer.innerHTML = `
    <table>
      <thead>
        <tr><th>Navn</th><th>Dato</th><th>Serie</th><th>Sted</th><th>Skudd</th><th>Poeng</th><th>Tid</th><th>Vindretning</th><th>Skrumelding</th><th>Miniatyr</th></tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>
  `;
});
