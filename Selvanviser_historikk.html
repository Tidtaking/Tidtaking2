document.getElementById('searchBtn').addEventListener('click', async () => {
  const name = document.getElementById('searchName').value.trim();
  const date = document.getElementById('searchDate').value;
  const resultsContainer = document.getElementById('searchResults');

  // Bygg spørringen basert på input
  let query = supabase.from('selvanviser').select('*').order('dato', { ascending: false });

  // Legg til betingelser for søket
  if (name) {
    query = query.ilike('navn', `%${name}%`);
  }
  if (date) {
    query = query.eq('dato', date);
  }

  // Hent data fra Supabase
  const { data, error } = await query;

  // Sjekk for feil
  if (error) {
    console.log(error);
    resultsContainer.innerHTML = 'Feil ved henting av data.';
    return;
  }

  // Hvis ingen resultater, vis melding
  if (!data.length) {
    resultsContainer.innerHTML = 'Ingen resultater funnet.';
    return;
  }

  // Lag tabell med resultatene
  const rows = data.map(r => `
    <tr>
      <td>${r.navn}</td>
      <td>${r.dato}</td>
      <td>${r.serie}</td>
      <td>${r.sted}</td>
      <td>${r.skudd}</td>
      <td>${r.poeng}</td>
      <td>${r.tid}</td>
      <td>${r.vindretning}</td>
      <td>${r.skrumelding}</td>
      <td><img src='${r.miniatur_dataurl}' width='80'></td>
    </tr>
  `).join('');

  // Sett resultatene i HTML
  resultsContainer.innerHTML = `
    <table>
      <thead>
        <tr>
          <th>Navn</th><th>Dato</th><th>Serie</th><th>Sted</th><th>Skudd</th><th>Poeng</th><th>Tid</th><th>Vind</th><th>Skrudd</th><th>Miniatyr</th>
        </tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>
  `;
});
