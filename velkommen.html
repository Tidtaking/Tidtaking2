<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LSK Tidtaking - Velkommen</title>
  <style>
    :root {
      --brand: #18469a;
      --brand-dark: #0f2f6b;
      --brand-accent: #dbe723;
    }
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 0;
      color: #333;
    }
    header {
      background: var(--brand);
      color: white;
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    header img {
      height: 60px;
      width: auto;
      border-radius: 8px;
      /* La til hvit bakgrunn for logoen slik den ser bedre ut */
      background: white; 
      padding: 4px;
    }
    header h1 {
      font-size: 28px;
      margin: 0;
    }
    header p {
      margin: 0;
      font-size: 14px;
      opacity: 0.85;
    }
    main {
      padding: 20px;
      max-width: 960px;
      margin: 0 auto;
    }
    h2 {
      text-align: center;
      margin-top: 30px;
      margin-bottom: 20px;
      color: var(--brand-dark);
    }
    .filter-container {
      margin: 0 auto 20px;
      max-width: 600px;
      text-align: left;
      background: #eee;
      padding: 15px;
      border-radius: 12px;
    }
    .filter-container label {
      font-size: 16px;
      margin: 5px 0;
      display: block;
    }
    .filter-container input {
      font-size: 16px;
      padding: 8px;
      margin-bottom: 10px;
      width: 100%;
      max-width: 300px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .filter-container button {
      font-size: 16px;
      padding: 8px 16px;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background: var(--brand);
      color: white;
      transition: 0.2s;
    }
    .filter-container button:hover {
      background: var(--brand-dark);
    }
    table {
      margin: 0 auto;
      border-collapse: collapse;
      width: 100%;
      max-width: 600px;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      font-size: 16px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }

    /* === NYTT DESIGN FOR NAVIGASJON === */
    .nav-grid {
      display: grid;
      /* Justert minmax for å gi kortene litt mer plass */
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
      gap: 16px;
      margin-top: 20px;
    }
    .navlink {
      display: block;
      text-align: left; /* Endret fra center */
      background-color: var(--brand);
      color: white;
      padding: 16px;
      border-radius: 12px;
      text-decoration: none;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }
    .navlink:hover {
      background-color: var(--brand-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.25);
    }
    /* Nye stiler for innholdet i kortene */
    .navlink strong {
        font-size: 18px;
        font-weight: 600;
        display: block;
        margin-bottom: 5px;
    }
    .navlink p {
        font-size: 14px;
        font-weight: normal;
        margin: 0;
        opacity: 0.9;
        line-height: 1.4;
    }
    /* === SLUTT PÅ NY CSS === */

    @media (max-width: 480px) {
      header h1 {
        font-size: 22px;
      }
      th, td {
        font-size: 14px;
        padding: 8px;
      }
      .navlink {
        font-size: 16px;
        padding: 12px;
      }
      /* Sørger for at kort-innholdet skalerer */
      .navlink strong {
        font-size: 16px;
      }
      .navlink p {
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  
  <header>
    <img src="lsk_logo.jpg" alt="Lørenskog Skiklubb Logo" onerror="this.style.display='none'">
    <div>
      <h1>Lørenskog Skiklubb</h1>
      <p>Velkommen til Tidtaking</p>
    </div>
  </header>

  <main>
    <h2>Finn dagens deltakere</h2>
    <div class="filter-container">
      <label for="competitionInput">Konkurransenavn:</label>
      <input type="text" id="competitionInput" placeholder="F.eks. Klubbløp-2025">
      
      <label for="dateInput">Dato (yyyy-mm-dd):</label>
      <input type="date" id="dateInput">
      
      <button id="filterBtn">Vis deltakere</button>
    </div>
    
    <div id="participantTable">
      <p style="text-align:center;">Laster deltakere...</p>
    </div>
    
    <h2>Verktøykasse for Tidtaking</h2>
    <div class="nav-grid">
      <a href="https://tidtaking.github.io/Tidtaking2/import" class="navlink">
        <strong>Import</strong>
        <p>Last opp startlister og deltakere før løpet.</p>
      </a>
      <a href="https://tidtaking.github.io/Tidtaking2/" class="navlink">
        <strong>Oppsett</strong>
        <p>Konfigurer innstillinger for dagens løp.</p>
      </a>
      <a href="https://tidtaking.github.io/Tidtaking2/starter.html" class="navlink">
        <strong>Starter</strong>
        <p>Registrer manuelle eller automatiske starttider.</p>
      </a>
      <a href="https://tidtaking.github.io/Tidtaking2/rundetider.html" class="navlink">
        <strong>Rundetider</strong>
        <p>Registrer mellomtider og rundepasseringer.</p>
      </a>
      <a href="https://tidtaking.github.io/Tidtaking2/skyting.html" class="navlink">
        <strong>Skyting</strong>
        <p>Registrer treff/bom for skiskyting.</p>
      </a>
      <a href="https://tidtaking.github.io/Tidtaking2/strafferunder.html" class="navlink">
        <strong>Strafferunder</strong>
        <p>Registrer løpere som går strafferunder.</p>
      </a>
       <a href="https://tidtaking.github.io/Tidtaking2/selvanviser" class="navlink">
        <strong>Selvanviser</strong>
        <p>Kobling mot system for selvanvisere.</p>
      </a>
      <a href="https://tidtaking.github.io/Tidtaking2/maal.html" class="navlink">
        <strong>Mål</strong>
        <p>Registrer målgang og sluttider.</p>
      </a>
      <a href="https://tidtaking.github.io/Tidtaking2/live.html" class="navlink">
        <strong>Livevisning</strong>
        <p>Viser resultater i sanntid for publikum.</p>
      </a>
      <a href="https://tidtaking.github.io/Tidtaking2/resultat" class="navlink">
        <strong>Resultater</strong>
        <p>Generer og vis offisielle resultatlister.</p>
      </a>
      <a href="https://tidtaking.github.io/Tidtaking2/sim" class="navlink">
        <strong>Simulator</strong>
        <p>Test systemet med simulerte løpsdata.</p>
      </a>
      <a href="https://tidtaking.github.io/Tidtaking2/historikk" class="navlink">
        <strong>Historikk</strong>
        <p>Se logger og data fra tidligere økter.</p>
      </a>
       <a href="https://tidtaking.github.io/Tidtaking2/huskeliste" class="navlink">
        <strong>Huskeliste</strong>
        <p>Sjekkliste for arrangører før og under løp.</p>
      </a>
      <a href="https://minavis.no/hurtigkomb.html" class="navlink">
        <strong>Hurtigkombinasjon</strong>
        <p>Eksternt verktøy for å kombinere tider.</p>
      </a>
    </div>
  </main>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.49.3/+esm';
    
    const supabaseUrl = "https://chzfewhbfkdtcizdxyzk.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoemZld2hiZmtkdGNpemR4eXprIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI2NDE1ODgsImV4cCI6MjA1ODIxNzU4OH0.RKgK8b1PHl9ZbFj57u_rD34e53Zlk3sGPHUru9KmuqA";
    const supabaseClient = createClient(supabaseUrl, supabaseKey);

    document.getElementById("dateInput").value = new Date().toISOString().split('T')[0];
    
    async function fetchParticipants() {
      const comp = document.getElementById("competitionInput").value.trim();
      const date = document.getElementById("dateInput").value;
      
      let query = supabaseClient.from('participants').select('*').eq('comp_date', date);
      if (comp !== "") query = query.eq('competition', comp);
      
      const { data: participants, error } = await query;
      if (error) {
        console.error("Feil ved henting:", error);
        document.getElementById("participantTable").innerHTML = "<p>Feil ved henting av deltakere.</p>";
        return;
      }
      if (!participants || participants.length === 0) {
        document.getElementById("participantTable").innerHTML = `<p style="text-align:center;">Ingen deltakere funnet for <strong>${comp||'valgt konkurranse'}</strong> den <strong>${date}</strong>.</p>`;
        return;
      }
      
      participants.sort((a,b)=>(parseInt(a.snr)||0)-(parseInt(b.snr)||0));
      let tableHtml = `<table><thead><tr><th>Startnummer</th><th>Navn</th></tr></thead><tbody>`;
      for (const p of participants) {
        tableHtml += `<tr><td>${p.snr||""}</td><td>${p.name||""}</td></tr>`;
      }
      tableHtml += "</tbody></table>";
      document.getElementById("participantTable").innerHTML = tableHtml;
    }
    
    document.addEventListener("DOMContentLoaded", fetchParticipants);
    document.getElementById("filterBtn").addEventListener("click", fetchParticipants);
  </script>
</body>
</html>
