<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Virtuell Gourmetkokk</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    /* Fullscreen kitchen interior */
    html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; }
    #background {
      position:fixed; top:0; left:0; width:100%; height:100%;
      background: url('https://images.unsplash.com/photo-1586190848861-99aa4a171e90?auto=format&fit=crop&w=1950&q=80') center/cover no-repeat;
      filter: brightness(0.6);
      z-index:-2;
    }
    /* Kitchen island in foreground */
    #island {
      position:fixed; bottom:0; left:50%; transform:translateX(-50%);
      width:120%; max-height:35%; object-fit:cover;
      z-index:-1;
    }
    /* Central panel */
    #panel {
      position:absolute; top:10%; left:50%; transform:translateX(-50%);
      width:90%; max-width:600px; max-height:80%;
      background:rgba(255,255,255,0.9); backdrop-filter:blur(10px);
      border-radius:16px; padding:24px; box-shadow:0 8px 30px rgba(0,0,0,0.4);
      display:flex; flex-direction:column;
      z-index:1;
    }
    /* Morten avatar and bubble */
    #morten-container {
      position:absolute; bottom:35%; left:50%; transform:translate(-50%,50%);
      display:flex; flex-direction:column; align-items:center; gap:8px; z-index:2;
    }
    #snakkeboble {
      display:none; background:rgba(255,255,255,0.9); padding:8px 12px;
      border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.2);
      max-width:220px; font-size:0.9rem;
      text-align:center;
    }
    #morten {
      width:140px; pointer-events:none;
    }
    .speaking { animation:bounce 1s infinite; }
    @keyframes bounce { 0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);} }
    /* Chat area */
    #chatbox { flex:1; overflow-y:auto; background:white; padding:16px;
      border-radius:8px; box-shadow:inset 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom:16px;
    }
    .loader { font-style:italic; color:#4A5568; }
  </style>
</head>
<body>
  <div id="background"></div>
  <img id="island" src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=1950&q=80" alt="Kitchen Island">

  <div id="morten-container">
    <div id="snakkeboble">Morten tenker ...</div>
    <img id="morten" src="https://media.giphy.com/media/3o7abldj0b3rxrZUxW/giphy.gif" alt="Kokk Morten">
  </div>

  <div id="panel">
    <header class="flex justify-between items-center mb-4">
      <h1 class="text-3xl font-bold">üç≥ Virtuell Gourmetkokk</h1>
      <p class="text-gray-600">Sp√∏r Morten om mat, oppskrifter og teknikker!</p>
    </header>

    <section class="mb-4">
      <h2 class="font-semibold mb-2">Dagens Retter</h2>
      <div id="rettKnappContainer" class="grid grid-cols-2 gap-2"></div>
    </section>

    <div id="chatbox">
      <div class="text-gray-500">Hei! Jeg er Morten ‚Äì din virtuelle gourmetkokk. Hva vil du lage i dag?</div>
    </div>

    <div class="flex mb-4">
      <input id="userInput" class="flex-1 p-2 border rounded-l-lg" placeholder="Hva vil du vite om matlaging?">
      <button id="sendBtn" class="bg-green-600 text-white px-4 rounded-r-lg">Send</button>
    </div>

    <div id="responseSection" class="hidden flex flex-col overflow-y-auto">
      <h2 class="font-semibold mb-2">Svar fra Morten:</h2>
      <div id="recipeText" class="bg-white p-4 rounded shadow mb-4 flex-1 overflow-y-auto"></div>
      <div id="videoSuggestion" class="hidden">
        <h3 class="font-semibold mb-2">Video:</h3>
        <iframe id="youtubeFrame" class="w-full aspect-video rounded shadow" src="" frameborder="0" allowfullscreen></iframe>
      </div>
    </div>
  </div>

  <script type="module">
    const ukedagsRetter = {
      0: ['Ramen','Burgere'],
      1: ['Lasagne','Salat'],
      2: ['Taco','Pasta'],
      3: ['Suppe','Sandwich'],
      4: ['Risotto','Curry'],
      5: ['Grill','Pizza'],
      6: ['Dhal','Fiskegryte']
    };

    // Render buttons
    const container = document.getElementById('rettKnappContainer');
    (ukedagsRetter[new Date().getDay()] || []).forEach(r => {
      const btn = document.createElement('button');
      btn.textContent = r;
      btn.className = 'bg-gray-200 p-2 rounded';
      btn.onclick = () => {
        document.getElementById('userInput').value = `Hvordan lager jeg ${r}?`;
        sendMessage();
      };
      container.appendChild(btn);
    });

    function mortenSnakker(p) {
      const morten = document.getElementById('morten');
      const boble  = document.getElementById('snakkeboble');
      if (p) { morten.classList.add('speaking'); boble.style.display = 'block'; }
      else   { morten.classList.remove('speaking'); boble.style.display = 'none'; }
    }

    async function sendMessage() {
      const inp = document.getElementById('userInput');
      const txt = inp.value.trim();
      if (!txt) return;

      const chat = document.getElementById('chatbox');
      chat.innerHTML += `<div class='mt-2'><strong>Du:</strong> ${txt}</div>`;
      inp.value = '';
      chat.scrollTop = chat.scrollHeight;

      const resp = document.getElementById('responseSection');
      const rec  = document.getElementById('recipeText');
      resp.classList.remove('hidden');

      // Loading state
      rec.innerHTML = `<div class='loader'>Morten tenker ...</div>`;
      mortenSnakker(true);

      try {
        const { pipeline } = await import('https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0');
        const gen = await pipeline('text-generation', 'Xenova/gpt2');
        const dish = txt.replace(/Hvordan lager jeg/i, '').replace('?', '').trim();
        const prompt = `Write a detailed recipe for ${dish}, including ingredients and instructions. Avoid generic phrases.`;
        const result = await gen(prompt, { max_new_tokens: 200 });
        let reply = result[0]?.generated_text || 'Beklager, ingen svar.';

        // Convert newlines without regex
        const html = reply.split('\n').join('<br>');
        rec.innerHTML = html;
      } catch (error) {
        rec.innerHTML = 'Beklager, noe gikk galt.';
        console.error(error);
      } finally {
        mortenSnakker(false);
      }
    }

    document.getElementById('sendBtn').onclick = sendMessage;
  </script>
</body>
</html>
