  <!-- Ferdigkompilert Tailwind CSS, ingen console‑warning -->
  <link href="https://cdn.jsdelivr.net/gh/tailwindlabs/tailwindcss@3.4.4/dist/tailwind.min.css" rel="stylesheet">  <style>[x-cloak]{display:none}</style>
</head>
<body class="bg-green-50 min-h-screen flex flex-col items-center p-3 sm:p-4">
  <header class="w-full max-w-4xl mb-4 sm:mb-6">
    <h1 class="text-2xl sm:text-3xl font-bold text-center mb-1">Golfscore</h1>
    <p class="text-center text-xs sm:text-sm text-gray-600">Registrer slag, flere spillere, WHS‑handicap og «spilte på». Lagres i Supabase om konfigurert, ellers lokalt.</p>
  </header>

  <main id="app" class="w-full max-w-4xl space-y-6 sm:space-y-8">

    <!-- 1. Bane -->
    <section class="bg-white p-3 sm:p-4 rounded-2xl shadow">
      <h2 class="text-lg sm:text-xl font-semibold mb-2">1. Velg eller legg inn bane</h2>
      <div class="flex flex-col sm:flex-row gap-2 mb-3">
        <input id="courseSearch" type="text" placeholder="Søk (navn/sted)…" class="flex-grow border rounded px-2 py-1" />
        <button id="searchBtn" class="px-3 py-1 rounded bg-emerald-600 text-white hover:bg-emerald-700">Søk</button>
        <button id="manualCourseBtn" class="px-3 py-1 rounded bg-gray-300 hover:bg-gray-400">Manuell</button>
      </div>

      <ul id="courseResults" class="space-y-1 max-h-60 overflow-y-auto"></ul>

      <!-- Valgt bane -->
      <div id="courseDetails" class="mt-4 hidden">
        <h3 class="font-semibold">Valgt bane</h3>
        <p id="courseName" class="mb-1"></p>
        <p class="text-sm text-gray-600">Par <span id="coursePar"></span> • CR <span id="courseRating"></span> • Slope <span id="courseSlope"></span></p>
      </div>

      <!-- Manuell bane‑modal -->
      <div id="courseModal" x-cloak class="fixed inset-0 bg-black/40 flex items-center justify-center hidden">
        <div class="bg-white rounded-2xl p-4 w-[90%] max-w-md shadow-xl space-y-2">
          <h3 class="text-lg font-semibold mb-1">Ny bane</h3>
          <input id="cName" class="w-full border rounded px-2 py-1" placeholder="Banenavn"/>
          <div class="flex gap-2">
            <input id="cPar" type="number" class="w-full border rounded px-2 py-1" placeholder="Par totale">
            <input id="cRating" type="number" step="0.1" class="w-full border rounded px-2 py-1" placeholder="Course Rating">
            <input id="cSlope" type="number" class="w-full border rounded px-2 py-1" placeholder="Slope">
          </div>
          <p class="text-xs text-gray-600">Hull‑par settes til 4‑4‑... men kan redigeres senere.</p>
          <div class="flex gap-2 justify-end pt-2">
            <button id="cancelCourseBtn" class="px-3 py-1 rounded bg-gray-200">Avbryt</button>
            <button id="saveCourseBtn" class="px-3 py-1 rounded bg-emerald-600 text-white">Lagre</button>
          </div>
        </div>
      </div>
    </section>

    <!-- 2. Spillere -->
    <section class="bg-white p-3 sm:p-4 rounded-2xl shadow">
      <h2 class="text-lg sm:text-xl font-semibold mb-2">2. Spillere</h2>
      <div class="flex flex-col sm:flex-row gap-2 mb-3">
        <input id="playerName" type="text" placeholder="Navn" class="flex-grow border rounded px-2 py-1" />
        <input id="playerHcp" type="number" step="0.1" placeholder="Hcp‑indeks" class="border rounded px-2 py-1 w-full sm:w-32" />
        <button id="addPlayerBtn" class="px-3 py-1 rounded bg-emerald-600 text-white hover:bg-emerald-700">Legg til</button>
      </div>
      <ul id="playerList" class="space-y-1"></ul>
    </section>

    <!-- 3. Slag -->
    <section id="scoreSection" class="bg-white p-3 sm:p-4 rounded-2xl shadow hidden overflow-auto">
      <h2 class="text-lg sm:text-xl font-semibold mb-2">3. Slag pr. hull</h2>
      <div class="overflow-auto">
        <table id="scoreTable" class="min-w-full text-center text-xs sm:text-sm"></table>
      </div>
    </section>

    <!-- 4. Sammendrag -->
    <section id="summarySection" class="bg-white p-3 sm:p-4 rounded-2xl shadow hidden">
      <h2 class="text-lg sm:text-xl font-semibold mb-2">4. Resultat</h2>
      <table id="summaryTable" class="w-full text-xs sm:text-sm text-center"></table>
    </section>
  </main>

<!-- Alpine.js -->
<script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
/*****   Konfig‑seksjon   *****/
const API_BASE = "https://api.golfcourseapi.com";   // (valgfritt) ekstern kurs‑API
const API_KEY  = "";                                // "Bearer sk_..."

// Overpass (OpenStreetMap) query for alle golfbaner i Norge (brukes som offline‑fallback)
const OVERPASS_URL = `https://overpass-api.de/api/interpreter?data=${encodeURIComponent('[out:json][timeout:25];area["ISO3166-1"="NO"]->.a;(node["golf"="course"](area.a);way["golf"="course"](area.a);relation["golf"="course"](area.a););out tags;')}`;

// Supabase – DINE verdier (Variant A: anonym‑nøkkel)
const SUPABASE_URL = "https://chzfewhbfkdtcizdxyzk.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoemZld2hiZmtkdGNpemR4eXprIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI2NDE1ODgsImV4cCI6MjA1ODIxNzU4OH0.RKgK8b1PHl9ZbFj57u_rD34e53Zlk3sGPHUru9KmuqA";

// Init‑klient
const supabase = window.Supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
const supabaseClient = supabase; // alias for lesbarhet

/*****   Tilstand   *****/
const state = { course:null, players:[], roundId:null };

/*****   Elementer   *****/
const qs = s=>document.querySelector(s);
const courseSearchInput = qs('#courseSearch');
const searchBtn         = qs('#searchBtn');
const manualCourseBtn   = qs('#manualCourseBtn');
const courseResults     = qs('#courseResults');
const courseDetailsBox  = qs('#courseDetails');
const courseNameLabel   = qs('#courseName');
const courseParLabel    = qs('#coursePar');
const courseRatingLabel = qs('#courseRating');
const courseSlopeLabel  = qs('#courseSlope');

/*****   Lokale kursdata   *****/
let norwayCourses = [];
ensureNorwayCourses(); // async henter OSM‑liste og cacher i localStorage

async function ensureNorwayCourses(){
  try{
    const cached = localStorage.getItem('norwayCourses');
    if(cached){ norwayCourses = JSON.parse(cached); return; }
    const res = await fetch(OVERPASS_URL);
    const data = await res.json();
    norwayCourses = data.elements.map(e=>({id:`osm_${
